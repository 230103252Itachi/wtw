# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —Å–º–µ–Ω–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Firebase Auth listener:
1. `_setupAuthListener()` - –°–ª—É—à–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è auth state
2. `_resetAndInitialize()` - –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ
3. `_clearAllData()` - –ü—Ä–∏ logout –æ—á–∏—â–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç UI

## –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω–∞—è —Å–º–µ–Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
1. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ User A
2. –î–æ–±–∞–≤–∏—Ç—å 2-3 –≤–µ—â–∏ –≤ –≥–∞—Ä–¥–µ—Ä–æ–±
3. –û—Ç–∫—Ä—ã—Ç—å Profile ‚Üí Logout
4. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ User B (–¥—Ä—É–≥–æ–π –∞–∫–∫–∞—É–Ω—Ç)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≥–∞—Ä–¥–µ—Ä–æ–± –ø—É—Å—Ç –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ User B

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[Wardrobe] üö™ User logged out
[Wardrobe] üóëÔ∏è All data cleared
[Wardrobe] üîÑ User switched to: {userB_id}
[Wardrobe] Initializing Firebase listener for user: {userB_id}
[Wardrobe] üì° Snapshot received: 0 docs  (–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—â–µ–π User B)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
1. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ User A
2. –î–æ–±–∞–≤–∏—Ç—å –≤–µ—â—å
3. Logout
4. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ User B
5. –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥—É—é –≤–µ—â—å
6. Logout
7. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —Å–Ω–æ–≤–∞ –∫–∞–∫ User A
8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤–µ—â—å User A (–Ω–µ User B)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
–í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
```
[Wardrobe] üîÑ User switched to: {uid}
[Wardrobe] üóëÔ∏è All data cleared
[Wardrobe] Initializing Firebase listener for user: {uid}
[Wardrobe] Initializing outfits listener for user: {uid}
[Wardrobe] üì° Snapshot received: {count} docs
[Wardrobe] ‚úÖ Loaded {count} items from Firebase snapshot
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```dart
StreamSubscription? _itemsSubscription;      // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –≤–µ—â–∏
StreamSubscription? _outfitsSubscription;    // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ outfits
String? _currentUserId;                      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ —é–∑–µ—Ä–∞
```

### –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã
1. `_setupAuthListener()` - –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
   - –°–ª—É—à–∞–µ—Ç `FirebaseAuth.authStateChanges()`
   - –ü—Ä–∏ —Å–º–µ–Ω–µ —é–∑–µ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `_resetAndInitialize()`
   - –ü—Ä–∏ logout –≤—ã–∑—ã–≤–∞–µ—Ç `_clearAllData()`

2. `_resetAndInitialize()` - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —é–∑–µ—Ä–∞
   - –û—Ç–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ `_clearAllData()`
   - –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —é–∑–µ—Ä–∞

3. `_clearAllData()` - –û—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - –û—Ç–º–µ–Ω—è–µ—Ç StreamSubscriptions
   - –û—á–∏—â–∞–µ—Ç —Å–ø–∏—Å–∫–∏ _items –∏ _saved
   - –í—ã–∑—ã–≤–∞–µ—Ç notifyListeners() —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å UI

### –ò–º–ø–æ—Ä—Ç—ã
–î–æ–±–∞–≤–ª–µ–Ω `import 'dart:async';` –¥–ª—è StreamSubscription

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–î–∞–Ω–Ω—ã–µ –≤—Å–µ –µ—â–µ –≤–∏–¥–Ω—ã –ø–æ—Å–ª–µ logout:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `AuthService.logout()`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `[Wardrobe] üö™ User logged out`

2. **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `[Wardrobe] üóëÔ∏è All data cleared`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π listener —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º uid

3. **Stream listener –Ω–µ –ø–µ—Ä–µ–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `_resetAndInitialize()` –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±–∞ –º–µ—Ç–æ–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `[Wardrobe] Initializing Firebase listener`

## –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã StreamSubscription –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è lifecycle –ø–æ–¥–ø–∏—Å–æ–∫
- –ü–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏)
- –°–æ—Ö—Ä–∞–Ω—ë–Ω —Ç–µ–∫—É—â–∏–π uid –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
